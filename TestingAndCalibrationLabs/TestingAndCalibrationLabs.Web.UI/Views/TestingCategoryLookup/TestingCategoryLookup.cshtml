
@model IEnumerable<TestingAndCalibrationLabs.Web.UI.Models.MeterialTests.TestingCategoryLookupModelDTO>
@{
    ViewData["Title"] = "TestingCategoryLookup";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


    

<body>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">


     <link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.0.45/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="a/style.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js">   
</script>  
 
    <div class="container">
        <div class="row">
            <div class="">
                <input type="text"  id="justAnInputBox2" placeholder="Select" autocomplete="on" style="overflow-y:auto" />
            </div>
        </div>
        <div class="mt-3 d-flex justify-content-between mb-3">
         <div class="p-2">Showing <span id="selectedCount">0</span> results of <span id="totalCount">0</span></div>
    <button type="button" class="btn btn-primary" onclick="document.getElementById('selectedMembersForm').submit()">Next</button>
  </div>
    </div>
  
   <form method="post" id="selectedMembersForm"  asp-action="Views">
        <div class="container mt-5">
            <div class="row" id="addDataHere">
            
            </div>
        </div>
    </form>



    <script src="https://code.jquery.com/jquery-3.4.1.min.js">
        const { Modal } = require("../../wwwroot/lib/bootstrap/dist/js/bootstrap");
    </script>
    <script src="a/comboTreePlugin.js" type="text/javascript"></script>



    <script type="text/javascript">

        var SampleJSONData =@ViewBag.jsonData;
        var tempArray=[];
        tempArray=@ViewBag.tempArray;
        var comboTree3;
        var selectedTitles=[];
        var getIDs=[];
        var ids=[];
        //Calculate number of employees
        document.getElementById("totalCount").innerText=tempArray.length;

        jQuery(document).ready(function($) {

                comboTree3 = $('#justAnInputBox2').comboTree({
                    source : SampleJSONData,
                    isMultiple: true,
                    cascadeSelect: true,
                    collapse: false
                });
                comboTree3.onChange(function(){
                    const myNode = document.getElementById("addDataHere");
                    ids=[];
                    document.getElementById("selectedCount").innerText=0;
                    if(myNode.innerHTML!="")
                          while (myNode.firstChild) {
                            myNode.removeChild(myNode.lastChild);
                          }
                    selectedTitles=comboTree3.getSelectedNames();
                    getIDs=comboTree3.getSelectedIds();
                    var selectedTilelsLength=0;
                    if(selectedTitles!=undefined)
                        selectedTilelsLength=selectedTitles.length;
                    
                    for(var i=0;i<selectedTilelsLength;i++)
                        createCards(selectedTitles[i],getIDs[i]);
                });
        });

        function createCards(selectedTitle,selectedID){
            var flag=0,i=ids.length;
            var rowId=0;
            
            for(var j=0;j<ids.length;j++){
                if(ids[j]==selectedID){
                    flag=1;
                }
            }

            if(flag==0){
                ids[i]=selectedID;
                var rowId=0;
                //Get row of selectedID
                for(var m=0;m<tempArray.length;m++)
                {
                    if(tempArray[m][0]==selectedID)
                    {
                        rowId=m;
                        break;
                    }
                }
                
                var a=document.createElement("div");
                a.setAttribute("id",ids[i]);
                a.classList.add("col-sm-4");

                var b=document.createElement("div");
                b.classList.add("card");
                b.classList.add("p-3");
                b.classList.add("mb-4");
                a.appendChild(b);

                var c=document.createElement("div");
                c.classList.add("d-flex");
                c.classList.add("justify-content-between");
                b.appendChild(c);

                var d=document.createElement("i");
                d.classList.add("material-icons");
                d.style.color="red";
                d.style.fontSize="60px";
                d.innerText=tempArray[rowId][1];
                c.appendChild(d);

                var e=document.createElement("button");
                e.classList.add("btn-close");
                e.classList.add("d-grid");
                e.classList.add("gap-2");
                e.setAttribute("data-bs-dismiss","modal");
                e.setAttribute("aria-label","Close");
                e.addEventListener('click',function(){
                    var tempArray=[];
                    var tempArrayIndex=0;
                    for(var l=0;l<ids.length;l++)
                        if(a.id!=ids[l])
                        {
                            tempArray[tempArrayIndex]=ids[l];
                            tempArrayIndex++;
                        }
                    comboTree3.clearSelection();
                    comboTree3.setSelection(tempArray);
                });
                c.appendChild(e);
                
                var f=document.createElement("h3");
                f.innerText=selectedTitle;
                b.appendChild(f);

                var g=document.createElement("p");
                g.innerText=tempArray[rowId][2];
                b.appendChild(g);
            
                var h=document.createElement("p");
                h.innerText="";
                b.appendChild(h);

                var ij=document.createElement("input");
                ij.setAttribute("type","hidden");
                ij.setAttribute("name","categoryId[]");
                ij.setAttribute("value",selectedID);
                a.appendChild(ij);

                var jk=document.createElement("input");
                jk.setAttribute("type","hidden");
                jk.setAttribute("name","categoryName[]");
                jk.setAttribute("value",selectedTitle);
                a.appendChild(jk);

                i++;
                document.getElementById("selectedCount").innerText=i; console.log(ids.length);
                document.getElementById("addDataHere").appendChild(a);
             }
        }
        
    </script>
   
</body>

